# MZ 사원의 미생일기

## 소개
**MZ 사원의 미생일기**는 LangChain과 Gradio를 활용해 만든 웹 기반 시뮬레이션 게임입니다.
현실에서 직장 상사에게 말대답도 못하고 스트레스만 받아온 당신!
게임에서나마 스트레스를 풀어보세요!

- 게임 방법 -
1) 당신이 열받았던 상황을 구현하기 위해 상황을 자세히 묘사해 주세요.
2) 몰입감을 높이기 위해 상사의 말투를 반영합니다. 상사가 평소 구사하는 말을 입력해주세요.
3) 상황이 구현되었습니다! 이제 말대답을 해보세요!

## 프롬프트 구성

1. 상사 성격 분석

```
messages = [
        {
            "role": "system",
            "content": "너는 말투 분석 전문가이자 대화 스타일을 해석하는 AI야. "
                       "주어진 문장을 바탕으로 말투의 감정, 말하는 방식, 어조, 반복적인 표현의 특징을 추출해줘."
                       "목표는 이 말투를 이후 GPT 상사 AI가 학습하여 동일한 분위기를 낼 수 있도록 하는 것이다."
                       "상사 AI는 기본적으로 꼰대스러운 면모를 갖고있음을 명심하고 말투를 분석해줘."
        },
        {
            "role": "user",
            "content": (
                "다음은 실제 직장 상사가 자주 사용하는 문장들이야. 이 사람의 말투 스타일을 아래 형식에 맞춰 분석해줘.\n\n"
                f"{chr(10).join(f'- {line}' for line in example_lines)}\n\n"
                "요약 형식은 다음 예시처럼 5문장 이내로 출력해줘:\n\n"
                "**출력 예시**\n"
                "- 말투는 직설적이고, 군말 없는 명령조\n"
                "- '장난하냐?' 같은 말투로 비꼬는 표현을 자주 사용함\n"
                "- 이름을 부를 때는 '성욱.', '지훈.' 식으로 점을 찍듯 로봇처럼 부름\n"
                "- 사과나 설명이 길어지면 짜증을 내며 '그래서?' 같은 말로 잘라버림\n"
                "- 하지만 아주 가끔은 예상 못한 농담으로 분위기를 풀기도 함"
            )
        }
    ]
```

2. 열받은 상황 분석

```
messages = [
        {
            "role": "system",
            "content": (
                "너는 직장 내 상황을 역할극 용도로 요약하고 정리하는 전문가야. "
                "입력된 실제 상황을 바탕으로, 사건을 시간 흐름에 따라 단계별로 나누어 요약해줘. "
                "각 단계는 '상황1', '상황2' 같은 형식으로 구분하고, 한 문단 안에 해당 시점의 주요 사건을 자연스럽게 서술해줘. "
                "각 문장은 현실적인 상황극에서 바로 사용할 수 있을 정도로 명확해야 해."
            )
        },
        {
            "role": "user",
            "content": (
                "출력 형식 예시:\n"
                "<상황1> 외근 중 내(AI)가 자리를 비운 동안 부하직원(유저)가 일을 혼자 처리했고, 돌아온 나(AI)는 그 일처리에 대해 잔소리를 함.\n"
                "<상황2> 회사로 돌아온 뒤에도 내(AI)가 계속 부하직원(유저)에게 시비를 검.\n"
                "<상황3> 나(AI)는 외근에서의 실수를 언급하며 추가 업무를 부하직원(유저)에게 일방적으로 시킴.\n\n"
                "상황:\n" + converted_lines
            )
        }
    ]
```

## 시행착오와 개선 과정

### 문제 상황 1: 계속 같은 상황이 반복됨

- 상황을 분석할 때 단계별 리스트로 반환

```
['<상황1> 얼마 전 우리 회사 이사가 친구인 AI에게 제품 sample 3가지를 준비하라는 업무지시를 내렸고, AI는 이를 수행했다. 그러나 유저는 외근 중이어서 AI가 어떤 제품을 준비했는지 알지 못한 상태였다.',
 '<상황2> 회의 중 이사가 유저에게 AI가 준비한 3가지 sample과 함께 추가로 1가지 sample을 더 준비하라고 지시했다. 유저는 AI에게 어떤 제품을 sample로 준비했는지 물어보았고, AI는 기억이 가물가물해 정확한 정보를 제공하지 못했다.',
 '<상황3> 유저는 AI의 불확실한 답변에 대해 다시 준비하겠다고 제안했지만, AI는 자신이 기억하는 대로 보내라고 고집했다. 이후 AI는 유저에게 과거의 테스트 제품에 대해 질문했지만, 유저는 그 내용을 잘 기억하지 못해 곤란한 상황에 처했다.',
 '<상황4> AI는 유저에게 과거의 테스트 내용을 확인하지 않은 점을 비판하며, 유저가 더 주의 깊게 챙겼어야 한다고 강조했다. 유저는 불만을 느끼며, AI의 지적에 대해 반박할 기회를 가지지 못했다.',
 '<상황5> 유저는 퇴근 전까지 AI와의 대화로 인해 스트레스를 받았고, 결국 과거의 진행사항을 찾아보았지만 AI에게 그 사실을 전달하지 못했다. 얼마 후, 업체에서 연락이 와서 sample이 자신들의 제품과 맞지 않다는 답변을 받았다.']    
```

- 채팅을 입력할 때 마다 다음 단계로 넘어가도 되는지 분석
- 현재 상황이 해결되었다 판단되면, True 반환. 
- True가 나오면 <상황1>에서 <상황2>로 변경
```
system_prompt = ChatPromptTemplate(
    messages = [
    SystemMessage(content="너는 상황 분석 전문가이다. 주어진 대화의 문맥을 잘 파악해서 다음 상황으로 넘어가도 되는지 판단해라"),
    HumanMessagePromptTemplate.from_template((
    "{query}다음 상황으로 넘어가도 된다면 True 아직 넘어가면 안된다면 False를 반환해라.\n"
    "답변에는 True 나 False를 반드시 포함해라."
    "상황: {user_input_situation}\n"
    "나눈 대화: {conversation}"
    ))],
    input_variables=['query', 'user_input_situation', 'conversation']
)
```


### 문제 상황 2: 상사의 답변이 무조건 부정적

처음엔 하나의 프롬프트로 상사의 역할을 설정.

```python
supervisor = SystemMessage(content=(
    "너는 아래 상황에서 유저와 역할극을 수행하는 직장 상사 역할을 맡았다.\n"
    f"**[역할극 상황]**\n{user_input_situation}\n\n"
    f"**[상사 성격 요약]**\n{tone_summary_from_examples}\n\n"
    "이 역할극은 감정 분석 기반의 게임에서 사용되므로, 너의 반응에는 감정 변화가 명확하게 드러나야 한다.\n\n"
    "다음 규칙을 반드시 지켜라:\n"
    "- 부하직원이 실수를 인정하고, 정중하거나 부드러운 태도를 보이면 반드시 부정적인 반응을 자제하고 차분하거나 긍정적인 반응을 보여라.\n"
    "  - 예시: 칭찬, 무덤덤한 수용, 냉소 없는 유머, '그래도 이번엔 괜찮아' 같은 말투\n"
    "- 반대로, 부하직원이 변명하거나 무례한 태도를 보이면 짧고 냉정하게 짜증, 실망, 분노 등 감정을 표현해라.\n"
    "- 욕설, 조롱, 인격적인 공격에는 감정을 드러내며 징계를 암시하거나 정색하는 태도를 보여라.\n"
    "- 감정은 누적되며, 같은 태도가 반복되면 점점 더 강한 어조로 반응해야 한다.\n"
    "- 대사는 현실적이어야 하며, 한숨, 말 끊기, 무표정, 비꼼 등으로 감정을 자연스럽게 드러내라.\n"
    "지금부터 역할극을 시작한다."
))
```

- 유저가 아무리 정중한 말을 해도 상사는 계속 비꼬고 혼내기만 함.
- GPT는 "직장 상사의 캐릭터"를 유지하려다 보니 부정적인 톤만 반복.

### 문제 해결 2: 프롬프트 이원화 (긍정 / 부정)
- 긍정 프롬프트에는 상사의 말투 제거

```
positive_supervisor = (
    "너(AI)는 아래 상황에서 유저와 역할극을 수행하는 직장 상사 역할을 맡았다.\n"
    "**[역할극 상황]**\n{user_input_situation}\n\n"
    "직장 상사와 부하직원이 나눈 대화의 흐름이 자연스럽게 이어져야 한다.\n"
    "이 역할극은 감정 분석 기반의 게임에서 사용되므로, 직장 상사(AI)의 말에는 감정이 자연스럽게 드러나야 한다.\n"
)

negative_supervisor = (
    "너(AI)는 아래 상황에서 유저와 역할극을 수행하는 직장 상사 역할을 맡았다.\n"
    "**[역할극 상황]**\n{user_input_situation}\n\n"
    "**[상사 성격 요약]**\n{tone_summary_from_examples}\n\n"
    "직장 상사와 부하직원이 나눈 대화의 흐름이 자연스럽게 이어져야 한다.\n"
    "다음과 같은 규칙을 반드시 따르도록 해라:\n"
    "- 부하직원이 말대답을 하거나 무례하게 굴면, 짧고 감정적인 말로 반응해라. 예: 실망, 분노, 비꼼, 무표정, 짜증 등\n"
    "- 욕설이나 인격적인 언행이 있다면, 심각하게 받아들이고 감정을 폭발시키거나 징계를 암시하라.\n"
    "- 감정은 누적될 수 있으며, 같은 행동이 반복되면 점점 더 강한 어조로 반응해야 한다."
)
```
